description "Jenkins CI Slave Agent"
author "James Page <james.page@ubuntu.com>"

start on runlevel [2345]
stop on runlevel [!2345]

pre-start script
    [ -r /etc/default/jenkins-slave ] && . /etc/default/jenkins-slave
    [ -n "$JENKINS_URL" ] || { stop; exit 0; }
    $JENKINS_ROOT/bin/download-slave.sh $JENKINS_URL
    mkdir $JENKINS_RUN  > /dev/null 2>&1  || true
    chown -R $JENKINS_USER $JENKINS_RUN || true
end script

script
    [ -r /etc/default/jenkins-slave ] && . /etc/default/jenkins-slave
    exec su -l $JENKINS_USER --shell=/bin/bash -c \
         "$JAVA $JAVA_ARGS -jar $JENKINS_RUN/slave.jar $JENKINS_ARGS" 
end script
