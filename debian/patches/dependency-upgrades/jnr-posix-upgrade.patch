Description: Transitional patch from jna-posix to jnr-posix as
 currently packaged in Debian and Ubuntu.
Author: James Page <james.page@ubuntu.com>
Forwarded: not-needed

Index: jenkins/core/src/main/java/hudson/os/PosixAPI.java
===================================================================
--- jenkins.orig/core/src/main/java/hudson/os/PosixAPI.java	2012-02-28 16:49:30.869862404 +0000
+++ jenkins/core/src/main/java/hudson/os/PosixAPI.java	2012-04-26 14:15:30.844630973 +0100
@@ -1,10 +1,9 @@
 package hudson.os;
 
-import org.jruby.ext.posix.JavaPOSIX;
 import org.jruby.ext.posix.POSIX;
 import org.jruby.ext.posix.POSIXFactory;
 import org.jruby.ext.posix.POSIXHandler;
-import org.jruby.ext.posix.POSIX.ERRORS;
+import com.kenai.constantine.platform.Errno;
 
 import java.io.File;
 import java.io.InputStream;
@@ -26,11 +25,11 @@
      * used a fallback java implementation which does not support many operations.
      */
     public boolean isNative() {
-        return !(posix instanceof JavaPOSIX);
+        return posix.isNative();
     }
 
     private static final POSIX posix = POSIXFactory.getPOSIX(new POSIXHandler() {
-        public void error(ERRORS errors, String s) {
+        public void error(Errno errors, String s) {
             throw new PosixException(s,errors);
         }
 
@@ -43,7 +42,7 @@
         }
 
         public boolean isVerbose() {
-            return false;
+            return true;
         }
 
         public File getCurrentWorkingDirectory() {
Index: jenkins/core/src/main/java/hudson/os/PosixException.java
===================================================================
--- jenkins.orig/core/src/main/java/hudson/os/PosixException.java	2012-02-28 16:49:30.885862453 +0000
+++ jenkins/core/src/main/java/hudson/os/PosixException.java	2012-04-26 14:15:30.844630973 +0100
@@ -1,6 +1,6 @@
 package hudson.os;
 
-import org.jruby.ext.posix.POSIX.ERRORS;
+import com.kenai.constantine.platform.Errno;
 
 /**
  * Indicates an error during POSIX API call.
@@ -8,14 +8,14 @@
  * @author Kohsuke Kawaguchi
  */
 public class PosixException extends RuntimeException {
-    private final ERRORS errors;
+    private final Errno errors;
 
-    public PosixException(String message, ERRORS errors) {
+    public PosixException(String message, Errno errors) {
         super(message);
         this.errors = errors;
     }
 
-    public ERRORS getErrorCode() {
+    public Errno getErrorCode() {
         return errors;
     }
 
Index: jenkins/core/pom.xml
===================================================================
--- jenkins.orig/core/pom.xml	2012-04-26 14:15:28.072632057 +0100
+++ jenkins/core/pom.xml	2012-04-26 14:15:30.844630973 +0100
@@ -105,6 +105,11 @@
       <version>1.0.3</version>
     </dependency>
     <dependency>
+      <groupId>org.jruby.extras</groupId>
+      <artifactId>jffi</artifactId>
+      <version>0.6.5</version>
+    </dependency>
+    <dependency>
       <groupId>org.kohsuke</groupId>
       <artifactId>trilead-putty-extension</artifactId>
       <version>1.0</version>
